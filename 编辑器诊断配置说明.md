# 🔧 编辑器诊断配置说明

## ✅ 已完成的配置

### 1. 关闭所有红线和下划线
- **位置**: `~/.config/nvim/lua/config/options.lua`
- **效果**: 关闭所有语言的错误提示红线

### 2. 关闭 Python 类型检查
- **位置**: `~/.config/nvim/lua/plugins/python.lua`
- **效果**:
  - 关闭 Pyright 类型检查
  - 不显示 pydantic 相关警告
  - 移除 flake8 诊断

### 3. 关闭 Markdown 文件检查 ✨ 新增
- **位置**: `~/.config/nvim/lua/plugins/markdown.lua` 和 `options.lua`
- **效果**:
  - 关闭 marksman LSP 诊断
  - 关闭 ltex 语法/拼写检查
  - 关闭拼写检查红线
  - Markdown 文件完全无诊断

### 4. 项目级配置
- **位置**: `pyrightconfig.json`（项目根目录）
- **效果**: 彻底关闭该项目的类型检查

---

## 🔄 应用配置

### 方法 1：重启 Neovide（推荐）
```bash
# 退出 Neovide，然后重新打开
```

### 方法 2：重新加载配置
在 Neovide 中执行：
```vim
:source ~/.config/nvim/init.lua
:LspRestart
```

### 方法 3：完全重启 LSP
在 Neovide 中执行：
```vim
:LspStop
:LspStart
```

---

## 📊 配置详解

### 关闭的内容

✅ **下划线** (underline) - 代码下方的波浪线
✅ **虚拟文本** (virtual_text) - 行尾的错误提示文字
✅ **侧边栏图标** (signs) - 左侧的错误/警告图标
✅ **类型检查** (typeCheckingMode) - Python 类型检查
✅ **Pydantic 警告** - 所有 pydantic 相关提示

### 保留的功能

✅ **代码补全** - 自动完成功能仍然可用
✅ **代码格式化** - Black 格式化仍然可用
✅ **语法高亮** - 代码高亮显示正常
✅ **跳转定义** - Go to definition 仍然可用

---

## ⚙️ 个性化调整

### 如果想部分显示错误提示

编辑 `~/.config/nvim/lua/config/options.lua`：

```lua
vim.diagnostic.config({
  -- 只在命令行显示，不显示红线
  virtual_text = false,      -- false = 关闭行尾提示
  signs = true,              -- true = 显示侧边栏图标
  underline = false,         -- false = 关闭下划线
  update_in_insert = false,
  severity_sort = true,
})
```

### 如果想重新启用某些检查

编辑 `~/.config/nvim/lua/plugins/python.lua`，修改第 12 行：

```lua
typeCheckingMode = "basic",  -- off/basic/standard/strict
```

**模式说明**：
- `off` - 完全关闭（当前设置）
- `basic` - 基础检查（温和）
- `standard` - 标准检查（中等）
- `strict` - 严格检查（严格）

### 如果想只关闭 pydantic 的警告

在 `pyrightconfig.json` 中添加：

```json
{
  "typeCheckingMode": "basic",
  "reportMissingTypeStubs": false,
  "exclude": [
    "**/site-packages/pydantic/**"
  ]
}
```

### 如果想重新启用 flake8

编辑 `~/.config/nvim/lua/plugins/python.lua`，取消注释：

```lua
-- 取消注释下面这行
table.insert(opts.sources, null_ls.builtins.diagnostics.flake8)
```

---

## 🎯 快捷键（可选）

### 手动查看诊断信息

如果关闭了显示但想手动查看错误，可以添加这些快捷键。

编辑 `~/.config/nvim/lua/config/keymaps.lua`：

```lua
-- 浮动窗口显示诊断
vim.keymap.set("n", "<leader>d", vim.diagnostic.open_float, { desc = "Show diagnostics" })

-- 跳转到下一个诊断
vim.keymap.set("n", "]d", vim.diagnostic.goto_next, { desc = "Next diagnostic" })

-- 跳转到上一个诊断
vim.keymap.set("n", "[d", vim.diagnostic.goto_prev, { desc = "Previous diagnostic" })

-- 显示所有诊断列表
vim.keymap.set("n", "<leader>q", vim.diagnostic.setloclist, { desc = "Diagnostic list" })
```

使用方法：
- `<leader>d` - 显示当前行的错误（浮动窗口）
- `]d` - 跳到下一个错误
- `[d` - 跳到上一个错误
- `<leader>q` - 打开错误列表

**注意**: `<leader>` 在 LazyVim 中默认是空格键 `Space`

---

## 🔍 检查配置是否生效

### 检查 1：查看 LSP 状态
在 Neovide 中执行：
```vim
:LspInfo
```

### 检查 2：查看诊断配置
在 Neovide 中执行：
```vim
:lua print(vim.inspect(vim.diagnostic.config()))
```

应该看到：
```lua
{
  underline = false,
  signs = false,
  virtual_text = false,
  ...
}
```

### 检查 3：测试编辑文件
打开一个 Python 文件，故意写一些类型错误：
```python
x: int = "string"  # 类型不匹配
```

如果配置成功，不应该看到任何红线或警告。

---

## 📂 文件清单

```
~/.config/nvim/
├── lua/
│   ├── config/
│   │   └── options.lua        ✅ 已修改（全局诊断配置）
│   └── plugins/
│       └── python.lua         ✅ 已修改（Python LSP 配置）
│
claude-web/
└── pyrightconfig.json         ✅ 已创建（项目级配置）
```

---

## ❓ 常见问题

### Q1: 还是有红线怎么办？

**可能原因**：
1. 配置未生效
2. 其他插件的诊断

**解决方案**：
```vim
" 完全重启 LSP
:LspStop
:LspStart

" 或重启 Neovide
```

### Q2: Markdown 文件仍有拼写检查红线

如果 Markdown 还有红线，执行：
```vim
:set nospell
```

或者确保 `~/.config/nvim/lua/config/options.lua` 中有：
```lua
vim.opt.spell = false
```

### Q3: JavaScript/TypeScript 也有红线

编辑 `~/.config/nvim/lua/plugins/` 创建新文件 `typescript.lua`：

```lua
return {
  {
    "neovim/nvim-lspconfig",
    opts = {
      servers = {
        tsserver = {
          settings = {
            diagnostics = {
              ignoredCodes = {},
            },
          },
        },
      },
      diagnostics = {
        underline = false,
        virtual_text = false,
        signs = false,
      },
    },
  },
}
```

### Q4: 想恢复默认配置

**步骤 1**: 删除或注释掉添加的配置
```bash
# 恢复 options.lua
vim ~/.config/nvim/lua/config/options.lua
# 删除 vim.diagnostic.config(...) 部分

# 恢复 python.lua
vim ~/.config/nvim/lua/plugins/python.lua
# 将 typeCheckingMode 改回 "basic"
```

**步骤 2**: 删除项目配置
```bash
rm pyrightconfig.json
```

**步骤 3**: 重启 Neovide

### Q5: 如何只针对某个项目关闭检查？

只使用 `pyrightconfig.json`，不修改全局配置文件。
在需要关闭检查的项目根目录创建该文件即可。

### Q6: 会影响代码质量吗？

**不会影响运行**：
- 代码仍然可以正常运行
- 只是不显示警告而已

**建议**：
- 开发时关闭（减少干扰）
- 提交前手动检查（`mypy`, `pylint` 等）
- CI/CD 中保留检查

---

## 💡 专业建议

### 适合关闭诊断的场景

✅ 学习阶段（专注于功能实现）
✅ 快速原型开发
✅ 使用动态特性较多的项目
✅ 第三方库类型定义不完善

### 建议保留诊断的场景

⚠️ 生产环境代码
⚠️ 团队协作项目
⚠️ 对类型安全要求高的项目
⚠️ 长期维护的项目

### 折中方案

可以配置为"温和模式"：
```lua
vim.diagnostic.config({
  virtual_text = false,        -- 不显示行尾文字
  signs = true,                -- 只显示侧边栏图标
  underline = false,           -- 不显示下划线
  severity_sort = true,
})
```

这样：
- 界面清爽（无红线）
- 仍能看到错误位置（侧边栏图标）
- 需要时可以手动查看详情

---

## 🆘 需要帮助？

### 查看日志
```vim
:messages           " 查看 Neovim 消息
:LspLog             " 查看 LSP 日志
```

### 查看已加载的 LSP
```vim
:LspInfo            " LSP 状态
:Mason              " 查看已安装的工具
```

### 重新安装 LSP 工具
```vim
:Mason              " 打开 Mason
" 找到 pyright 和 black
" 按 X 卸载，按 i 重新安装
```

---

## ✨ 效果对比

### 之前
```
def hello(name):
    ~~~~~~~~~~~~~~~~~~~~~~ ← 红线
    return f"Hello {name}"
    ^^^^^^^^^^^^^^^^^^^^^^ ← 类型警告
```

### 现在
```
def hello(name):
    return f"Hello {name}"
```

清爽无干扰！🎉

---

**配置完成！享受清爽的编程体验！** 🚀

如需调整，随时参考本文档。
